var A=Object.defineProperty;var C=(e,t,n)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var f=(e,t,n)=>(C(e,typeof t!="symbol"?t+"":t,n),n);import{s as m,j as s,R as b,r,K as I,M as R,a1 as k,O as F,a2 as L,H as U,J as E,T as N,U as z,$ as v,a0 as B,a3 as M}from"./index-bdd07f4b.js";import{O,A as y,C as V,s as D,v as P,t as q,z as S,w as H,x as T,y as w}from"./BaseFormSchema-89cf1931.js";const W=m(O)`
  width: 100vw;
`,_=({children:e})=>s.jsx(W,{children:s.jsx(b,{children:e})});function J(e,t){const[n,p]=r.useState(),[h,c]=r.useState(!1),[g,i]=r.useState(!1),x=r.useContext(I),l=R();function j(){return!!(e&&t)}r.useEffect(()=>{let a=!0;if(j())return i(!0),x.authentication.login(e,t).then(o=>{a&&(p("login"),c(!0),l(k({id:o.id,authId:o.authId,token:o.token,picture:o.picture,email:o.email})),l(F({open:!0,message:"User Session Fetched",severity:"success"})))}).catch(async o=>{if(a)switch(o.code){case L.NotFound:await u();break;default:l(F({open:!0,message:"User Could Not Be Logged In",severity:"error"}));break}}).finally(()=>{a&&i(!1)}),()=>{a=!1}},[e,t]);async function u(){l(F({open:!0,message:"User Not Found",severity:"error"})),p("register")}return[n,g,h]}m(y)(({theme:e})=>({backgroundColor:e.palette.primary.main,color:e.typography.button.color,textAlign:"center",cursor:"pointer",textDecoration:"none"}));m(V)(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",gap:e.spacing(2),minWidth:"300px"}));m("img")(({})=>({maxWidth:"140px"}));class K extends q{constructor(){super(...arguments);f(this,"username",{name:"username",label:"Username",tooltip:"Insert Username please",validationSchema:S.string().min(1)});f(this,"password",{name:"password",label:"Password",tooltip:"Password",validationSchema:S.string().min(1)})}createEditSaveRequest(n){return{username:n.username,password:n.password}}}const d=new K,$=D(d);function G(e){return P({resolver:H($),defaultValues:e,mode:"onBlur"})}const Q=({})=>{const e=U(),[t,n]=r.useState({username:"",password:""}),[p,h,c]=J(t.username,t.password);r.useEffect(()=>{c&&e(E)},[c]);const{handleSubmit:g,control:i}=G({username:"",password:""}),x=()=>{window.open("http://localhost:8085/api/auth/v1/open/passport/google","_self")},u=g(a=>{const o=d.createEditSaveRequest(a);n(o)},a=>{console.log("invalid form",a)});return s.jsx("div",{children:s.jsxs(T,{onSubmit:u,children:[s.jsx(N,{variant:"h2",children:"Sign in"}),s.jsx(w,{fieldMapping:d.username,control:i}),s.jsx(w,{fieldMapping:d.password,control:i}),h&&s.jsx(z,{animateOnly:!0}),s.jsx(y,{color:"secondary",onClick:u,"data-cy":"cancel-edit-btn",children:"Login"}),s.jsx(y,{onClick:x,"data-cy":"save-pokemon-btn",children:"Register"})]})})},ee=()=>s.jsx(_,{children:s.jsxs(v,{children:[s.jsx(v,{path:"login",element:s.jsx(Q,{})}),s.jsx(v,{path:"*",element:s.jsx(B,{to:M.login})})]})});export{ee as AuthenticationRoutes};
