var C=Object.defineProperty;var b=(e,s,n)=>s in e?C(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var F=(e,s,n)=>(b(e,typeof s!="symbol"?s+"":s,n),n);import{s as p,j as t,R as A,r,K as I,M as k,a1 as R,O as y,a2 as L,H as U,J as E,T as N,U as z,$ as v,a0 as B,a3 as M}from"./index-185e5e80.js";import{O,A as d,C as V,s as D,v as P,t as T,z as S,w as q,x as H,y as w}from"./BaseFormSchema-ab388487.js";const W=p(O)`
  width: 100vw;
`,_=({children:e})=>t.jsx(W,{children:t.jsx(A,{children:e})});function J(e,s){const[n,h]=r.useState(),[g,u]=r.useState(!1),[x,i]=r.useState(!1),f=r.useContext(I),c=k();function j(){return!!(e&&s)}r.useEffect(()=>{let a=!0;if(j())return i(!0),f.authentication.login(e,s).then(o=>{a&&(h("login"),u(!0),c(R({id:o.id,authId:o.authId,token:o.token,picture:o.picture,email:o.email})),c(y({open:!0,message:"User Session Fetched",severity:"success"})))}).catch(async o=>{if(a)switch(o.code){case L.NotFound:await l();break;default:c(y({open:!0,message:"User Could Not Be Logged In",severity:"error"}));break}}).finally(()=>{a&&i(!1)}),()=>{a=!1}},[e,s]);async function l(){c(y({open:!0,message:"User Not Found",severity:"error"})),h("register")}return[n,x,g]}p(d)(({theme:e})=>({backgroundColor:e.palette.primary.main,color:e.typography.button.color,textAlign:"center",cursor:"pointer",textDecoration:"none"}));p(V)(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",gap:e.spacing(2),minWidth:"300px"}));p("img")(({})=>({maxWidth:"140px"}));class K extends T{constructor(){super(...arguments);F(this,"username",{name:"username",label:"Username",tooltip:"Insert Username please",validationSchema:S.string().min(1)});F(this,"password",{name:"password",label:"Password",tooltip:"Password",validationSchema:S.string().min(1)})}createEditSaveRequest(n){return{username:n.username,password:n.password}}}const m=new K,$=D(m);function G(e){return P({resolver:q($),defaultValues:e,mode:"onBlur"})}const Q=({})=>{const e=U(),[s,n]=r.useState({username:"",password:""}),[h,g,u]=J(s.username,s.password);r.useEffect(()=>{u&&e(E)},[u]);const{handleSubmit:x,control:i}=G({username:"",password:""}),f=()=>{window.open("http://localhost:8085/api/auth/v1/open/passport/google","_self")},l=x(a=>{const o=m.createEditSaveRequest(a);n(o)},a=>{console.log("invalid form",a)});return t.jsx("div",{children:t.jsxs(H,{onSubmit:l,children:[t.jsx(N,{variant:"h2",children:"Sign in"}),t.jsx(w,{fieldMapping:m.username,control:i}),t.jsx(w,{fieldMapping:m.password,control:i}),g&&t.jsx(z,{animateOnly:!0}),t.jsx(d,{color:"secondary",onClick:l,"data-cy":"cancel-edit-btn",children:"Login"}),t.jsx(d,{color:"secondary",onClick:l,"data-cy":"cancel-edit-btn",children:"Test"}),t.jsx(d,{onClick:f,"data-cy":"save-pokemon-btn",children:"Register"})]})})},ee=()=>t.jsx(_,{children:t.jsxs(v,{children:[t.jsx(v,{path:"login",element:t.jsx(Q,{})}),t.jsx(v,{path:"*",element:t.jsx(B,{to:M.login})})]})});export{ee as AuthenticationRoutes};
